(function(){for(var q,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},r="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this,ba=["Object","is"],ca=0;ca<ba.length-1;ca++){var da=ba[ca];da in r||(r[da]={});r=r[da]}var ea=ba[ba.length-1],fa=r[ea],ga=fa?fa:function(a,b){return a===b?0!==a||1/a===1/b:a!==a&&b!==b};ga!=fa&&null!=ga&&aa(r,ea,{configurable:!0,writable:!0,value:ga});
var y=this;function A(a,b,c){a=a.split(".");c=c||y;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)a.length||void 0===b?c[d]&&c[d]!==Object.prototype[d]?c=c[d]:c=c[d]={}:c[d]=b}
function ha(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function G(a){return"array"==ha(a)}function H(a){return"string"==typeof a}function ia(a){return"number"==typeof a}function I(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ja="closure_uid_"+(1E9*Math.random()>>>0),ka=0;function la(a,b,c){return a.call.apply(a.bind,arguments)}
function ma(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function J(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?J=la:J=ma;return J.apply(null,arguments)}var na=Date.now||function(){return+new Date};
function oa(a,b){function c(){}c.prototype=b.prototype;a.oa=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.na=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}};function pa(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")};var qa=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(H(a))return H(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},ra=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=H(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)},sa=Array.prototype.filter?function(a,b,c){return Array.prototype.filter.call(a,
b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,h=H(a)?a.split(""):a,g=0;g<d;g++)if(g in h){var k=h[g];b.call(c,k,g,a)&&(e[f++]=k)}return e},ta=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=H(a)?a.split(""):a,h=0;h<d;h++)h in f&&(e[h]=b.call(c,f[h],h,a));return e};function ua(a){return Array.prototype.concat.apply([],arguments)}
function va(a,b,c){return 2>=arguments.length?Array.prototype.slice.call(a,b):Array.prototype.slice.call(a,b,c)};function wa(){}
function xa(a,b,c){if(null==b)c.push("null");else{if("object"==typeof b){if(G(b)){var d=b;b=d.length;c.push("[");for(var e="",f=0;f<b;f++)c.push(e),xa(a,d[f],c),e=",";c.push("]");return}if(b instanceof String||b instanceof Number||b instanceof Boolean)b=b.valueOf();else{c.push("{");e="";for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(f=b[d],"function"!=typeof f&&(c.push(e),ya(d,c),c.push(":"),xa(a,f,c),e=","));c.push("}");return}}switch(typeof b){case "string":ya(b,c);break;case "number":c.push(isFinite(b)&&
!isNaN(b)?String(b):"null");break;case "boolean":c.push(String(b));break;case "function":c.push("null");break;default:throw Error("Unknown type: "+typeof b);}}}var za={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"},Aa=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;
function ya(a,b){b.push('"',a.replace(Aa,function(a){var b=za[a];b||(b="\\u"+(a.charCodeAt(0)|65536).toString(16).substr(1),za[a]=b);return b}),'"')};function Ba(a){if(y.JSON)try{return y.JSON.stringify(a)}catch(c){}var b=[];xa(new wa,a,b);return b.join("")};function Ca(a,b){for(var c in a)if(b.call(void 0,a[c],c,a))return!0;return!1}function Da(a,b){for(var c in a)if(!b.call(void 0,a[c],c,a))return!1;return!0}var Ea="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Fa(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Ea.length;f++)c=Ea[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};var K={};A("VERSION","0.0.9.243",K);function L(a,b,c,d,e){return{siteId:a,seqId:b,context:c,invCount:d||0,load:e||null}}function Ga(){return{vector:{},size:0}}function Ha(a,b){var c=a.vector[b];c||(c=a.vector[b]=Ia(),a.size++);return c}function Ia(a,b,c){return{seqId:a||0,invCluster:b||{},invClusterSize:c||0}}function Ja(a,b){var c=a.vector[b];return c?c.seqId:0}
function N(a,b,c,d){if(H(b)){var e=b;c=c||0;b=d||0}else e=b.siteId,c=b.seqId,b=b.invCount;a=Ha(a,e);a.seqId=Math.max(c,a.seqId);b&&(e=a.invCluster[c],e||(e=0,a.invClusterSize++),a.invCluster[c]=Math.max(b,e))}
function Ka(a,b,c){if(H(b)){var d=b;c=c||0;b=0}else d=b.siteId,c=b.seqId,b=b.invCount;if(a.vector[d])if(1<c||b){a=Ha(a,d);d=c;1<b&&(a.invCluster[c]>=b&&(a.invCluster[c]=b-1),d++);for(;d<=a.seqId;d++)d in a.invCluster&&(delete a.invCluster[d],a.invClusterSize--);a.seqId=Math.min(a.seqId,b?c:c-1)}else delete a.vector[d],a.size--}
function O(a){var b=Ga(),c;for(c in a.vector){var d=a.vector[c],e=d.invCluster,f={},h;for(h in e)f[h]=e[+h];b.vector[c]=Ia(d.seqId,f,d.invClusterSize)}b.size=a.size;return b}function P(a,b){var c=b.seqId,d=a.vector[b.siteId];return!!(d&&d.seqId>=c&&(d.invCluster[c]||0)>=b.invCount)}
function La(a,b){if(a.size<b.size)return!1;for(var c in b.vector){var d=a.vector[c],e=b.vector[c];if(!d||d.seqId<e.seqId||d.invClusterSize<e.invClusterSize)return!1;var d=d.invCluster,e=e.invCluster,f;for(f in e)if((d[+f]||0)<e[+f])return!1}return!0}function Ma(a){return Q(a)&&0<a}
function Na(a){var b=0;return I(a)&&Q(a.size)&&I(a.vector)&&Da(a.vector,function(a){b++;var c=0;return I(a)&&Q(a.seqId)&&0<a.seqId&&Q(a.invClusterSize)&&I(a.invCluster)&&Da(a.invCluster,function(b,d){c++;return Q(b)&&Q(d)&&0<d&&d<=a.seqId})&&c==a.invClusterSize})&&b==a.size}function Q(a){return(ia(a)||H(a))&&!isNaN(a)}y.performance&&"function"==ha(y.performance.now)&&J(y.performance.now,y.performance);function Oa(a,b){return pa.apply(null,arguments)}
A("ops.getUid",function(a){return[a.siteId,a.seqId,a.invCount].join("|")},K);A("ops.canApply",function(a,b){b||(b=Ga());var c=a.siteId,d=a.seqId,e=a.invCount,f=Ja(b,c);if(e){if(f=f>=d)c=b.vector[c],f=(c&&c.invCluster[d]||0)==e-1;d=f}else d=f==d-1;return d&&La(b,a.context)},K);A("ops.seen",function(a,b){return P(b||Ga(),a)},K);
A("ops.enumerate",function(a,b){for(var c=ua.apply(null,va(arguments,1)),d=0;d<c.length;d++){var e=c[d],e=L(e.siteId,e.seqId,e.context,e.invCount,e.load);e.execOrder=a++;c[d]=e}return c},K);function Pa(a){this.c=a||100;this.a=this.b=0;this.f=[]}function Qa(a,b){a.f[(a.b+a.a)%a.c]=b;a.a<a.c?a.a++:a.b++}function Ra(a){if(a.a){var b=a.f[(a.b+a.a-1)%a.c];a.a--}return b}Pa.prototype.get=function(a){var b;0<=a&&a<this.a&&(b=this.f[(this.b+this.a-a-1)%this.c]);return b};function Sa(a){this.b=0;this.c=a||100;this.a=[]}Sa.prototype.add=function(a){var b=this.a[this.b];this.a[this.b]=a;this.b=(this.b+1)%this.c;return b};Sa.prototype.get=function(a){a=Ta(this,a);return this.a[a]};Sa.prototype.set=function(a,b){a=Ta(this,a);this.a[a]=b};function Ta(a,b){if(b>=a.a.length)throw Error("Out of bounds exception");return a.a.length<a.c?b:(a.b+Number(b))%a.c};function Ua(a,b,c){this.h=b;this.f=a;this.a={};this.b=[];this.c=[];if(c){a=c.vector;for(var d in a)c=a[d],R(this,d,c.seqId,c.invCluster)}b&&R(this,b)}
function Va(a,b){var c=a.c[a.a[b.siteId]],d=a.f,e=a.a,f,h=+b.seqId,g=+b.invCount,k=+b.execOrder||NaN,l=h-c.h-1,m=c.f[h]||0;if(h==c.b+1){var n=!g;var p=!n}else c.b>=h?(n=m+1==g,p=m>=g&&!!k):n=p=!1;if(!n&&!p)throw Error("Сломались seqIdы");if(0>l)for(l=~l,c.a||(c.a=[]),m=c.a,f=m.length;f<l;f++)m[f]=null;else m=c.g;if(p&&(f=Wa(c,h,g),!isNaN(f)&&f!=k))throw Error("Passed operation is already stored with different execution order");p=m[l];p||(d=g%2?d(b):b.load,f=b.context,g&&(f=O(f),Ka(f,c.c,h)),p=m[l]=
{load:d,context:Xa(f,e),cache:null,A:g?NaN:k});if(g){p.l||(p.l=[]);for(f=p.l.length;f<g-1;f++)p.l[f]=NaN;p.l[g-1]=k}else p.A=k;n&&(g?c.f[h]=g:c.b=h)}Ua.prototype.g=function(a){var b=a.context.vector,c;for(c in b)R(this,c);R(this,a.siteId);Va(this,a)};
function Ya(a,b,c){b=b.vector;c=c.vector;for(var d=[],e=0;e<a.b.length;e++){var f=a.b[e],h=a.c[e],g=b[f];if(g){var k=g.seqId;var l=g.invCluster}else k=0,l={};if(g=c[f]){var m=g.seqId;var n=g.invCluster}else m=0,n={};a:{var g=void 0,p=d,w=a.f,x=a.b,B=a.h==f;for(g in n){g=+g;f=n[g];var F=(l[g]||0)+1;if(g<=k&&f>=F&&!Za(h,p,g,F,f,w,x,B)){g=!1;break a}}for(g=k+1;g<=m;g++)if(f=n[g]||0,!Za(h,p,g,0,f,w,x,B)){g=!1;break a}g=!0}if(!g)return null}d.sort($a);return d}
Ua.prototype.cache=function(a,b){var c=a.siteId;R(this,c);R(this,b);return this.c[this.a[c]].cache(a,b,this.a)};function R(a,b,c,d){b in a.a||(a.a[b]=a.b.length,a.b.push(b),a.c.push(new ab(b,c,d)))}function $a(a,b){var c=a.execOrder,d=b.execOrder,e=a.siteId,f=a.seqId,h=b.siteId,g=b.seqId;return Ma(c)?Ma(d)?c-d:-1:Ma(d)?1:e==h?f==g?a.invCount-b.invCount:f-g:P(b.context,a)?-1:P(a.context,b)?1:e<h?-1:1}
function ab(a,b,c){this.c=a;this.b=b||0;this.f={};if(c)for(var d in c)this.f[d]=c[+d];this.h=this.b;this.g=[];this.a=null}
ab.prototype.get=function(a,b,c,d,e){var f=bb(this,a);if(f){for(var h=this.c,g=f.context,k=Ga(),l=0;l<g.length;l++){var m=e[l],n=g[l],p={},w=0;if(ia(n))var x=n;else{x=n[0];for(var B=1;B<n.length;B+=2)p[n[B]]=n[B+1],w++}x&&(k.vector[m]=Ia(x,p,w),k.size++)}e=L(h,a,k,0,f.load)}else e=null;e&&(c?(e.load=null,e.doUndoPair=!0):b&1&&(e.load=d(e)),(e.invCount=b)&&N(e.context,this.c,a,b-1),e.execOrder=Wa(this,a,b));return e};function Wa(a,b,c){return(a=bb(a,b))?c?a.l&&a.l[c-1]||NaN:a.A:NaN}
ab.prototype.cache=function(a,b,c){var d=bb(this,a.seqId);if(d){d.cache||(d.cache=[]);b=c[b];if(d.cache.length<b)for(var e=d.cache.length;e<b;e++)d.cache.push(null);d.cache[b]||(d.cache[b]=new Sa(10));d.cache[b].add({load:a.load,X:!!(a.invCount&1),context:Xa(a.context,c)})}return!!d};function bb(a,b){var c=b-a.h-1;if(0>c){c=~c;var d=a.a;if(!d)return null}else d=a.g;return d.length>c?d[c]:null}
function Xa(a,b){var c=[],d;for(d in b)c.push(0);var e=a.vector;for(d in e){var f=e[d];var h=f.seqId;if(f.invClusterSize){h=[h];var f=f.invCluster,g;for(g in f)h.push(+g,+f[+g])}c[b[d]]=h}return c}function Za(a,b,c,d,e,f,h,g){a=(e=a.get(c,e,!!((e-d)%2),f,h))?e.execOrder=Wa(a,c,d):NaN;if(g||!isNaN(a))b.push(e);else return!1;return!0};function S(a,b,c,d,e,f){if(!(this instanceof S))return new S(a,b,c,d,e,f);this.f=c||null;this.m=a;this.i=b;this.c=+d||0;this.a=e||Ga();this.j=!0;this.h=new Pa(f);this.g=new Pa(f);this.b=new Ua(b,this.f,this.a);if(!Na(this.a))throw Error("Passed value is not a valid context object");a=0;b=this.a.vector;for(var h in b){c=b[h];a+=+c.seqId;c=c.invCluster;for(var g in c)a+=+c[+g]}if(a!=this.c)throw Error("Last executed operation order and initial context ops count do not match");return this}q=S.prototype;
q.P=function(a){if(!this.f)throw Error("To be able to commit operations, clv.Document must be created with a siteId");a=G(a)?ta(a,this.G,this):[this.G(a)];var b=sa(a,this.u);Qa(this.h,va(a,0));var c=this.g;c.a=c.b=c.f.length=0;return{toSend:a,toExec:b,missing:!1}};
q.M=function(a){var b=ua(a),c,d=this.c+1;a=[];var e=[],f=[];for(c=0;c<b.length;c++){var h=b[c];if(!(I(h)&&H(h.siteId)&&Q(h.seqId)&&0<h.seqId&&Q(h.invCount)&&Na(h.context)))throw Error(Oa("Passed value is not a valid operation object\nPassed: %s\nSee valid format at: %s",Ba(h),"http://?????"));if(!Ma(h.execOrder))throw Error("Operation passed to update lacks valid execOrder property");var g=+h.execOrder;if(g>d)throw Error("Operations enumeration order is broken");var k=P(this.a,h),l=h.siteId==this.f;
if(g==d){if(k)if(l)e.push(h);else throw a=Error,g=Oa("Пришла операция, согласно контексту ее выполнили, согласно execOrder нет, где-то хуйня\nНужно посоветовать проверить что в конструктор документа передаетсяexecOrder и contextExec order: %s\nContext: %s\nOperation: %s",g.toString(),Ba(this.a),Ba(h)),a(g);else{if(l)throw Error("A collision in site ids detected");a.push(cb(h))}d++}else if(k)f.push(h);else throw Error("Пришла операция. согласно экзек ордеру она уже выполнена, согласно контексту нет, хуйня");
}ra(f,this.b.g,this.b);ra(e,this.ia,this);h=[];b=!0;for(c=0;c<a.length;c++){g=a[c];if(!La(this.a,g.context))throw Error("CC3 fails - an operation cannot be executed on the document");this.b.g(g);b=db(this,g,Ya(this.b,g.context,this.a));if(!b)break;N(this.a,g);this.c=Math.max(this.c,g.execOrder);this.u(g)&&h.push(g)}a=b?h:null;return{toExec:a||[],missing:!a}};q.J=function(){return!!this.h.a};q.ka=function(a){return eb(this,this.h,this.g,!a)};q.I=function(){return!!this.g.a};
q.ca=function(a){return eb(this,this.g,this.h,!a)};q.S=function(){return this.f};q.K=function(){return O(this.a)};q.L=function(){return this.c};q.V=function(){return this.j};q.ha=function(a){this.j=!!a;return this};q.G=function(a){var b=this.f,c=O(this.a);a=L(b,Ja(c,b)+1,c,0,null!=a?a:null);N(this.a,a);Va(this.b,a);return a};q.u=function(a){return null!=a.load};function cb(a){var b=L(a.siteId,a.seqId,O(a.context),a.invCount,a.load);if(a=a.execOrder)b.execOrder=a;return b}
q.ia=function(a){Va(this.b,a);this.c=Math.max(this.c,a.execOrder)};
function eb(a,b,c,d){var e,f=[],h=[],g=!0;for(d=d?f:h;g&&!d.length&&(e=Ra(b));){var k=a;for(var l=e,m=[],n=l.length;n--;){var p=l[n],w=L(p.siteId,p.seqId,O(p.context),p.invCount+1,k.i(p));N(w.context,p);m.push(w)}k=m;Qa(c,k);for(l=0;l<k.length;l++){m=k[l];Va(a.b,m);n=L(m.siteId,m.seqId,O(m.context),m.invCount,m.load);g=db(a,n,Ya(a.b,n.context,a.a));if(!g)break;N(a.a,n);a.u(n)&&h.push(n);f.push(m)}}return{toSend:f,toExec:h,missing:!g}}
function db(a,b,c){if(c&&c.length&&b.invCount){var d=c;if(d&&d.length){b.load=a.i(b);b.invCount--;Ka(b.context,b);c=[];for(var e=[],f=0;f<d.length;f++){var h=d[f];P(b.context,h)||P(h.context,b)?e.push(d[f]):c.push(d[f])}d=!0;c.length&&(d=db(a,b,c));N(b.context,b);b.load=a.i(b);b.invCount++;c=d?e:null}else c=d}if(c&&c.length)for(e=0;e<c.length;e++){d=c[e];if(d.doUndoPair)N(b.context,d);else{var g=a.b;a:{var f=void 0,h=g.c[g.a[d.siteId]],k=d.seqId,l=d.invCount,m=b.context,n=g.b,p=bb(h,k);if(p&&p.cache&&
(f=p.cache[g.a[b.siteId]]))for(g=0,p=f.a.length;g<p;g++){var w=f.get(g);b:{var x=n.length;if(!w||l&1^+w.X||m.size>x)x=!1;else{for(var B=w.context,F=0,t=0;t<x;t++){var u=B[t]||0;if(u){F++;var v=m.vector[n[t]];if(ia(u)){var D=u;var E=0}else D=u[0],E=(u.length-1)/2;if(!v||v.seqId!=D||v.invClusterSize!=E){x=!1;break b}if(E)for(v=v.invCluster,D=u.length,E=1;E<D;E+=2)if((v[+u[E]]||0)!=u[E+1]){x=!1;break b}}}x=F!=m.size?!1:!0}}if(x){f=L(h.c,k,O(m),l,w.load);break a}}f=null}if(f)d=f;else if(!db(a,d,Ya(a.b,
d.context,b.context)))return!1;f=fb(a,b,d);h=fb(a,d,b);b.load=f;d.load=h;a.b.cache(d,b.siteId)}a.b.cache(b,d.siteId)}return!!c}function fb(a,b,c){var d=b.load;null!=b.load&&null!=c.load&&(d=a.m(b,c));N(b.context,c);return d}var T=S.prototype;T.commit=T.P;T.update=T.M;T.canUndo=T.J;T.undo=T.ka;T.canRedo=T.I;T.redo=T.ca;T.getUndoOneOpAtATime=T.V;T.setUndoOneOpAtATime=T.ha;T.getSiteId=T.S;T.getContext=T.K;T.getExecOrder=T.L;A("Document",S,K);function gb(){0!=hb&&(this[ja]||(this[ja]=++ka));this.C=this.C;this.la=this.la}var hb=0;gb.prototype.C=!1;function ib(a,b){this.type=a;this.b=this.a=b;this.ea=!0};var jb="closure_listenable_"+(1E6*Math.random()|0),kb=0;function lb(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.capture=!!d;this.v=e;this.key=++kb;this.o=this.s=!1}function mb(a){a.o=!0;a.listener=null;a.a=null;a.src=null;a.v=null};function nb(a){this.src=a;this.a={};this.b=0}nb.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.a[f];a||(a=this.a[f]=[],this.b++);var h=ob(a,b,d,e);-1<h?(b=a[h],c||(b.s=!1)):(b=new lb(b,this.src,f,!!d,e),b.s=c,a.push(b));return b};function pb(a,b){var c=b.type;if(!(c in a.a))return!1;var d=a.a[c],e=qa(d,b),f;(f=0<=e)&&Array.prototype.splice.call(d,e,1);f&&(mb(b),a.a[c].length||(delete a.a[c],a.b--));return f}
function qb(a,b,c){var d=void 0!==b,e=d?b.toString():"",f=void 0!==c;return Ca(a.a,function(a){for(var b=0;b<a.length;++b)if(!(d&&a[b].type!=e||f&&a[b].capture!=c))return!0;return!1})}function ob(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.o&&f.listener==b&&f.capture==!!c&&f.v==d)return e}return-1};var rb="closure_lm_"+(1E6*Math.random()|0),sb={},tb=0;function ub(a,b,c,d,e){if(G(b))for(var f=0;f<b.length;f++)ub(a,b[f],c,d,e);else(c=vb(c),a&&a[jb])?a.H(b,c,d,e):a&&(a=wb(a))&&(b=a.a[b.toString()],a=-1,b&&(a=ob(b,c,!!d,e)),c=-1<a?b[a]:null)&&(ia(c)||!c||c.o||((d=c.src)&&d[jb]?d.w(c):(e=c.type,b=c.a,d.removeEventListener?d.removeEventListener(e,b,c.capture):d.detachEvent&&d.detachEvent(e in sb?sb[e]:sb[e]="on"+e,b),tb--,(e=wb(d))?(pb(e,c),e.b||(e.src=null,d[rb]=null)):mb(c))))}
function wb(a){a=a[rb];return a instanceof nb?a:null}var xb="__closure_events_fn_"+(1E9*Math.random()>>>0);function vb(a){if("function"==ha(a))return a;a[xb]||(a[xb]=function(b){return a.handleEvent(b)});return a[xb]};function U(){gb.call(this);this.b=new nb(this);this.ja=this}oa(U,gb);U.prototype[jb]=!0;q=U.prototype;q.removeEventListener=function(a,b,c,d){ub(this,a,b,c,d)};function yb(a,b){var c=a.ja,d=b,e=d.type||d;if(H(d))d=new ib(d,c);else if(d instanceof ib)d.a=d.a||c;else{var f=d,d=new ib(e,c);Fa(d,f)}c=d.b=c;zb(c,e,!0,d);zb(c,e,!1,d)}q.B=function(a,b,c,d){return this.b.add(String(a),b,!1,c,d)};q.$=function(a,b,c,d){return this.b.add(String(a),b,!0,c,d)};
q.H=function(a,b,c,d){var e=this.b;a=String(a).toString();if(a in e.a){var f=e.a[a];b=ob(f,b,c,d);-1<b?(mb(f[b]),Array.prototype.splice.call(f,b,1),f.length||(delete e.a[a],e.b--),e=!0):e=!1}else e=!1;return e};q.w=function(a){return pb(this.b,a)};q.da=function(a){if(this.b){var b=this.b;a=a&&a.toString();var c=0,d;for(d in b.a)if(!a||d==a){for(var e=b.a[d],f=0;f<e.length;f++)++c,mb(e[f]);delete b.a[d];b.b--}b=c}else b=0;return b};
function zb(a,b,c,d){b=a.b.a[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var h=b[f];if(h&&!h.o&&h.capture==c){var g=h.listener,k=h.v||h.src;h.s&&a.w(h);e=!1!==g.call(k,d)&&e}}return e&&0!=d.ea}q.W=function(a,b){return qb(this.b,void 0!==a?String(a):void 0,b)};function V(a,b){U.call(this);this.g=a||1;this.c=b||y;this.h=J(this.j,this);this.i=na()}oa(V,U);V.prototype.f=!1;V.prototype.a=null;V.prototype.j=function(){if(this.f){var a=na()-this.i;0<a&&a<.8*this.g?this.a=this.c.setTimeout(this.h,this.g-a):(this.a&&(this.c.clearTimeout(this.a),this.a=null),yb(this,"tick"),this.f&&(this.a=this.c.setTimeout(this.h,this.g),this.i=na()))}};V.prototype.start=function(){this.f=!0;this.a||(this.a=this.c.setTimeout(this.h,this.g),this.i=na())};function Ab(a){U.call(this);this.i=!0;this.m=this.g=Bb;this.ma=a||null;this.c=[];this.h=0;this.f=null;this.j=200;this.F=1E3;this.a={totalRequestsSent:0,successfulRequests:0,failedRequests:0,completeRequests:0,emptyRequestsSent:0,loadedRequestsSent:0,totalUpdatesSent:0,deliveredUpdates:0,lostUpdates:0,reQueuedUpdates:0,receivedUpdates:0}}oa(Ab,U);var Bb="complete";q=Ab.prototype;
q.start=function(a){if(!this.D)throw Error("Sending function is not set");void 0!==a&&(this.F=a);this.f||(this.f=new V(this.F,this.ma),this.f.B("tick",this.ba,!1,this),this.f.start())};q.O=function(){if(this.f){var a=this.f;a.f=!1;a.a&&(a.c.clearTimeout(a.a),a.a=null)}};q.N=function(a,b){this.h=Math.max(a,this.h);this.c.push.apply(this.c,b);this.f||this.start()};q.fa=function(a){this.j=a};q.R=function(){return this.j};
q.ba=function(){if(this.g===Bb){var a=this.c.splice(0,Math.min(this.c.length,this.j)),b=a.length;if(b){var c="sending";var d={type:"before-send-updates",value:a}}else c="requesting-updates",d={type:"before-request-updates"};yb(this,d);Cb(this,c);c=J(this.aa,this,a);this.D(this.h,a,c);this.a.totalRequestsSent++;this.a.totalUpdatesSent+=b;b?this.a.loadedRequestsSent++:this.a.emptyRequestsSent++}};
q.aa=function(a,b,c,d){this.a.completeRequests++;b?(this.a.successfulRequests++,a&&a.length&&(this.a.deliveredUpdates+=a.length,yb(this,{type:"updates-delivered",value:a})),d&&d.length&&(this.a.receivedUpdates+=d.length,yb(this,{type:"updates-received",value:d})),void 0!==c&&Q(c)&&(this.h=c)):(this.a.failedRequests++,this.a.lostUpdates+=a.length,this.a.reQueuedUpdates+=a.length,this.c=a.concat(this.c));this.i=b;Cb(this,Bb)};q.ga=function(a){this.D=a};q.Y=function(){return this.i};
q.Z=function(){return!this.c.length&&"sending"!==this.g&&"sending"!==this.m&&this.i};q.U=function(){return this.g};function Cb(a,b){a.m=a.g;a.g=b;yb(a,{type:"status-changed",status:a.g,prevStatus:a.m})}q.T=function(){return this.a};var W=Ab.prototype;W.start=W.start;W.stop=W.O;W.send=W.N;W.isOnline=W.Y;W.isUpToDate=W.Z;W.getStatus=W.U;W.getStat=W.T;W.setSendingFn=W.ga;W.getMaxUpdatesCount=W.R;W.setMaxUpdatesCount=W.fa;W.hasListener=W.W;W.listen=W.B;W.listenOnce=W.$;W.unlisten=W.H;
W.unlistenByKey=W.w;W.removeAllListeners=W.da;A("net.Http",Ab,K);function Db(){}function Eb(a,b,c,d){if(b==c)return[[0,b]];"undefined"==typeof d&&(d=!0);var e=Fb(b,c),f=b.substring(0,e);b=b.substring(e);c=c.substring(e);var e=Gb(b,c),h=b.substring(b.length-e);b=b.substring(0,b.length-e);c=c.substring(0,c.length-e);b=Hb(a,b,c,d);f&&b.unshift([0,f]);h&&b.push([0,h]);Ib(a,b);return b}
function Hb(a,b,c,d){if(!b)return[[1,c]];if(!c)return[[-1,b]];var e=b.length>c.length?b:c;var f=b.length>c.length?c:b,h=e.indexOf(f);if(-1!=h){var g=[[1,e.substring(0,h)],[0,f],[1,e.substring(h+f.length)]];b.length>c.length&&(g[0][0]=g[2][0]=-1);return g}if(e=Jb(b,c)){c=e[1];var k=e[3];b=e[4];g=Eb(a,e[0],e[2],d);a=Eb(a,c,k,d);return g.concat([[0,b]],a)}d&&(100>b.length||100>c.length)&&(d=!1);d&&(k=Kb(b,c),b=k[0],c=k[1],k=k[2]);a:{e=b;var f=c,l=(new Date).getTime()+1E3,h=e.length,m=f.length,n=h+m-
1,p=64<n,w=[],x=[],B={},F={};B[1]=0;F[1]=0;for(var t,u,v={},D=!1,E=!!v.hasOwnProperty,M=(h+m)%2,C=0;C<n&&!((new Date).getTime()>l);C++){w[C]={};for(var z=-C;z<=C;z+=2){t=z==-C||z!=C&&B[z-1]<B[z+1]?B[z+1]:B[z-1]+1;u=t-z;p&&(g=t+","+u,M&&(E?v.hasOwnProperty(g):void 0!==v[g])&&(D=!0),M||(v[g]=C));for(;!D&&t<h&&u<m&&e.charAt(t)==f.charAt(u);)t++,u++,p&&(g=t+","+u,M&&(E?v.hasOwnProperty(g):void 0!==v[g])&&(D=!0),M||(v[g]=C));B[z]=t;w[C][t+","+u]=!0;if(t==h&&u==m){g=Lb(w,e,f);break a}if(D){x=x.slice(0,
v[g]+1);g=Lb(w,e.substring(0,t),f.substring(0,u));g=g.concat(Mb(x,e.substring(t),f.substring(u)));break a}}if(p)for(x[C]={},z=-C;z<=C;z+=2){t=z==-C||z!=C&&F[z-1]<F[z+1]?F[z+1]:F[z-1]+1;u=t-z;g=h-t+","+(m-u);!M&&(E?v.hasOwnProperty(g):void 0!==v[g])&&(D=!0);for(M&&(v[g]=C);!D&&t<h&&u<m&&e.charAt(h-t-1)==f.charAt(m-u-1);)t++,u++,g=h-t+","+(m-u),!M&&(E?v.hasOwnProperty(g):void 0!==v[g])&&(D=!0),M&&(v[g]=C);F[z]=t;x[C][t+","+u]=!0;if(D){w=w.slice(0,v[g]+1);g=Lb(w,e.substring(0,h-t),f.substring(0,m-u));
g=g.concat(Mb(x,e.substring(h-t),f.substring(m-u)));break a}}}g=null}g||(g=[[-1,b],[1,c]]);if(d){d=g;b=k;for(c=0;c<d.length;c++){k=d[c][1];e=[];for(f=0;f<k.length;f++)e[f]=b[k.charCodeAt(f)];d[c][1]=e.join("")}Nb(a,g);g.push([0,""]);c=b=d=0;for(k=e="";d<g.length;){switch(g[d][0]){case 1:c++;k+=g[d][1];break;case -1:b++;e+=g[d][1];break;case 0:if(1<=b&&1<=c){k=Eb(a,e,k,!1);g.splice(d-b-c,b+c);d=d-b-c;for(b=k.length-1;0<=b;b--)g.splice(d,0,k[b]);d+=k.length}b=c=0;k=e=""}d++}g.pop()}return g}
function Kb(a,b){function c(a){for(var b="",c=0,f=-1,g=d.length;f<a.length-1;){f=a.indexOf("\n",c);-1==f&&(f=a.length-1);var h=a.substring(c,f+1),c=f+1;(e.hasOwnProperty?e.hasOwnProperty(h):void 0!==e[h])?b+=String.fromCharCode(e[h]):(b+=String.fromCharCode(g),e[h]=g,d[g++]=h)}return b}var d=[],e={};d[0]="";var f=c(a),h=c(b);return[f,h,d]}
function Lb(a,b,c){for(var d=[],e=b.length,f=c.length,h=null,g=a.length-2;0<=g;g--)for(;;)if(a[g].hasOwnProperty?a[g].hasOwnProperty(e-1+","+f):void 0!==a[g][e-1+","+f]){e--; -1===h?d[0][1]=b.charAt(e)+d[0][1]:d.unshift([-1,b.charAt(e)]);h=-1;break}else if(a[g].hasOwnProperty?a[g].hasOwnProperty(e+","+(f-1)):void 0!==a[g][e+","+(f-1)]){f--;1===h?d[0][1]=c.charAt(f)+d[0][1]:d.unshift([1,c.charAt(f)]);h=1;break}else{e--;f--;if(b.charAt(e)!=c.charAt(f))throw Error("No diagonal.  Can't happen. (diff_path1)");
0===h?d[0][1]=b.charAt(e)+d[0][1]:d.unshift([0,b.charAt(e)]);h=0}return d}
function Mb(a,b,c){for(var d=[],e=0,f=b.length,h=c.length,g=null,k=a.length-2;0<=k;k--)for(;;)if(a[k].hasOwnProperty?a[k].hasOwnProperty(f-1+","+h):void 0!==a[k][f-1+","+h]){f--; -1===g?d[e-1][1]+=b.charAt(b.length-f-1):d[e++]=[-1,b.charAt(b.length-f-1)];g=-1;break}else if(a[k].hasOwnProperty?a[k].hasOwnProperty(f+","+(h-1)):void 0!==a[k][f+","+(h-1)]){h--;1===g?d[e-1][1]+=c.charAt(c.length-h-1):d[e++]=[1,c.charAt(c.length-h-1)];g=1;break}else{f--;h--;if(b.charAt(b.length-f-1)!=c.charAt(c.length-
h-1))throw Error("No diagonal.  Can't happen. (diff_path2)");0===g?d[e-1][1]+=b.charAt(b.length-f-1):d[e++]=[0,b.charAt(b.length-f-1)];g=0}return d}function Fb(a,b){if(!a||!b||a.charCodeAt(0)!==b.charCodeAt(0))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(f,e)==b.substring(f,e)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e}
function Gb(a,b){if(!a||!b||a.charCodeAt(a.length-1)!==b.charCodeAt(b.length-1))return 0;for(var c=0,d=Math.min(a.length,b.length),e=d,f=0;c<e;)a.substring(a.length-e,a.length-f)==b.substring(b.length-e,b.length-f)?f=c=e:d=e,e=Math.floor((d-c)/2+c);return e}
function Jb(a,b){function c(a,b,c){for(var d=a.substring(c,c+Math.floor(a.length/4)),e=-1,f="",g,h,k,m;-1!=(e=b.indexOf(d,e+1));){var l=Fb(a.substring(c),b.substring(e)),v=Gb(a.substring(0,c),b.substring(0,e));f.length<v+l&&(f=b.substring(e-v,e)+b.substring(e,e+l),g=a.substring(0,c-v),h=a.substring(c+l),k=b.substring(0,e-v),m=b.substring(e+l))}return f.length>=a.length/2?[g,h,k,m,f]:null}var d=a.length>b.length?a:b,e=a.length>b.length?b:a;if(10>d.length||1>e.length)return null;var f=c(d,e,Math.ceil(d.length/
4)),d=c(d,e,Math.ceil(d.length/2)),h;if(f||d)d?h=f?f[4].length>d[4].length?f:d:d:h=f;else return null;if(a.length>b.length){f=h[0];d=h[1];e=h[2];var g=h[3]}else e=h[0],g=h[1],f=h[2],d=h[3];return[f,d,e,g,h[4]]}function Nb(a,b){for(var c=!1,d=[],e=0,f=null,h=0,g=0,k=0;h<b.length;)0==b[h][0]?(d[e++]=h,g=k,k=0,f=b[h][1]):(k+=b[h][1].length,null!==f&&f.length<=g&&f.length<=k&&(b.splice(d[e-1],0,[-1,f]),b[d[e-1]+1][0]=1,e--,e--,h=0<e?d[e-1]:-1,k=g=0,f=null,c=!0)),h++;c&&Ib(a,b);Ob(b)}
function Ob(a){function b(a,b){if(!a||!b)return 5;var g=0;if(a.charAt(a.length-1).match(c)||b.charAt(0).match(c))if(g++,a.charAt(a.length-1).match(d)||b.charAt(0).match(d))if(g++,a.charAt(a.length-1).match(e)||b.charAt(0).match(e))g++,(a.match(f)||b.match(h))&&g++;return g}for(var c=/[^a-zA-Z0-9]/,d=/\s/,e=/[\r\n]/,f=/\n\r?\n$/,h=/^\r?\n\r?\n/,g=1;g<a.length-1;){if(0==a[g-1][0]&&0==a[g+1][0]){var k=a[g-1][1],l=a[g][1],m=a[g+1][1],n=Gb(k,l);if(n)var p=l.substring(l.length-n),k=k.substring(0,k.length-
n),l=p+l.substring(0,l.length-n),m=p+m;for(var n=k,p=l,w=m,x=b(k,l)+b(l,m);l.charAt(0)===m.charAt(0);){var k=k+l.charAt(0),l=l.substring(1)+m.charAt(0),m=m.substring(1),B=b(k,l)+b(l,m);B>=x&&(x=B,n=k,p=l,w=m)}a[g-1][1]!=n&&(n?a[g-1][1]=n:(a.splice(g-1,1),g--),a[g][1]=p,w?a[g+1][1]=w:(a.splice(g+1,1),g--))}g++}}
function Ib(a,b){b.push([0,""]);for(var c=0,d=0,e=0,f="",h="",g;c<b.length;)switch(b[c][0]){case 1:e++;h+=b[c][1];c++;break;case -1:d++;f+=b[c][1];c++;break;case 0:if(d||e){if(d&&e){if(g=Fb(h,f))0<c-d-e&&0==b[c-d-e-1][0]?b[c-d-e-1][1]+=h.substring(0,g):(b.splice(0,0,[0,h.substring(0,g)]),c++),h=h.substring(g),f=f.substring(g);if(g=Gb(h,f))b[c][1]=h.substring(h.length-g)+b[c][1],h=h.substring(0,h.length-g),f=f.substring(0,f.length-g)}d?e?b.splice(c-d-e,d+e,[-1,f],[1,h]):b.splice(c-d-e,d+e,[-1,f]):
b.splice(c-d-e,d+e,[1,h]);c=c-d-e+(d?1:0)+(e?1:0)+1}else c&&0==b[c-1][0]?(b[c-1][1]+=b[c][1],b.splice(c,1)):c++;d=e=0;h=f=""}""===b[b.length-1][1]&&b.pop();d=!1;for(c=1;c<b.length-1;)0==b[c-1][0]&&0==b[c+1][0]&&(b[c][1].substring(b[c][1].length-b[c-1][1].length)==b[c-1][1]?(b[c][1]=b[c-1][1]+b[c][1].substring(0,b[c][1].length-b[c-1][1].length),b[c+1][1]=b[c-1][1]+b[c+1][1],b.splice(c-1,1),d=!0):b[c][1].substring(0,b[c+1][1].length)==b[c+1][1]&&(b[c-1][1]+=b[c+1][1],b[c][1]=b[c][1].substring(b[c+1][1].length)+
b[c+1][1],b.splice(c+1,1),d=!0)),c++;d&&Ib(a,b)};function X(a,b){return{type:0,at:a,value:b}}function Y(a,b){return{type:1,at:a,value:b}}function Pb(a,b){var c=a.load,d=b.load;if(!c||!d)return c;c=Qb[c.type<<1|d.type];if(!c)throw"Wrong operations passed to a transformation function.";return c(a,b)}function Rb(a){var b=a.load;if(!b)return b;b=Sb[b.type];if(!b)throw"Wrong operations passed to an inversion function.";return b(a)}
var Qb=[function(a,b){var c=a.load,d=c.at,c=c.value,e=b.load,f=e.at,e=e.value.length;return c=d>f||d==f&&a.siteId>b.siteId?X(d+e,c):X(d,c)},function(a,b){var c=a.load,d=c.at,e=c.value,f=b.load,h=f.at,f=f.value.length;d>h+f?c=X(d-f,c.value):d>=h?c=null:c=X(d,e);return c},function(a,b){var c=a.load,d=c.at,c=c.value,e=c.length,f=b.load,h=f.at,f=f.value,g=f.length;d>h?c=Y(d+g,c):(d+e>=h&&(c=c.substring(0,h-d)+f+c.substring(h-d)),c=Y(d,c));return c},function(a,b){var c=a.load,d=c.at,c=c.value,e=d+c.length-
1,f=b.load,h=f.at,f=f.value.length,g=h+f-1,k=Math.max(h,d),l=Math.min(g,e);k<=l?k==d&&l==e?c=null:(c=c.substring(0,k-d)+c.substring(l+1-d),c=Y(Math.min(d,h),c)):c=d>g?Y(d-f,c):Y(d,c);return c}],Sb=[function(a){return Y(a.load.at,a.load.value)},function(a){return X(a.load.at,a.load.value)}];function Tb(a,b){var c=b.load;if(c){c=Ub[c.type];if(!c)throw"Wrong operations passed to an exec function.";a=c(a,b)}return a}
var Ub=[function(a,b){var c=b.load,d=c.at;return a.substring(0,d)+c.value+a.substring(d)},function(a,b){var c=b.load,d=c.at;return a.substring(0,d)+a.substring(d+c.value.length)}];function Vb(a,b,c){var d=b.load;if(d){d=Wb[d.type];if(!d)throw"Wrong operations passed to a moveCursor function.";a=d(a,b,c)}return a}var Wb=[function(a,b,c){var d=b.load,e=d.at,d=d.value.length;return a>e||a==e&&b.siteId<c?a+d:a},function(a,b){var c=b.load,d=c.at,c=c.value.length;return a>d?Math.max(d,a-c):a}],Z={};
A("insert",X,Z);A("remove",Y,Z);A("transform",Pb,Z);A("invert",Rb,Z);A("exec",function(a,b){if(b)if(G(b))for(var c=0;c<b.length;c++)a=Tb(a,b[c]);else a=Tb(a,b);return a},Z);A("moveCursor",function(a,b,c){if(b)if(G(b))for(var d=0;d<b.length;d++)a=Vb(a,b[d],c);else a=Vb(a,b,c);return a},Z);A("genOps",function(a,b){var c=new Db,d=Eb(c,a,b);Nb(c,d);for(var c=0,e=[],f,h=0;h<d.length;h++){var g=d[h];f=g[0];var k=g[1],g=k.length;f?(-1==f?f=Y(c,k):(f=X(c,k),c+=g),e.push(f)):c+=g}return e},Z);
A("OpType.INSERT",0,Z);A("OpType.REMOVE",1,Z);A("ops.string",Z,K);function Xb(a,b,c,d){if(!(this instanceof Xb))return new Xb(a,b,c,d);S.call(this,Pb,Rb,a,b,c,d);return this}oa(Xb,S);A("string.Document",Xb,K);A("collaborative",K,void 0);A("clv",K,void 0);}).call(this);
